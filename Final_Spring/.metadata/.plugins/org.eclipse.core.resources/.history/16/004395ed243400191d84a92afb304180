package com.hb.chat;

import javax.inject.Inject;
import javax.servlet.http.HttpSession;
import javax.websocket.HandshakeResponse;
import javax.websocket.server.HandshakeRequest;
import javax.websocket.server.ServerEndpointConfig;

import org.springframework.stereotype.Component;

import com.google.inject.Injector;

@Component
public class HttpSessionConfigurator extends ServerEndpointConfig.Configurator {

	@Inject private static Injector injector;
	
    @Override
	public <T> T getEndpointInstance(Class<T> endpointClass) throws InstantiationException {
    	 return injector.getInstance(endpointClass);
	}

	@Override
    public void modifyHandshake(ServerEndpointConfig sec, HandshakeRequest request, HandshakeResponse response) {
        System.out.println("modifyHandshake() Current thread " + Thread.currentThread().getName());
        sec.getUserProperties().put("http", request.getHttpSession()); 
        System.out.println("modifyHandshake() User " + "http" + " with http session ID " + ((HttpSession) request.getHttpSession()).getId());
    }

}